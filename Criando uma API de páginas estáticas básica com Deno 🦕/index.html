<!doctype html>
<html lang="en">

<head>
        <title>Criando uma API de p√°ginas est√°ticas b√°sica com Deno ü¶ï - Meus Textos</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        
        
        

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="../assets/css/bootstrap.min.css">
        <link rel="stylesheet" href="../assets/css/dracula-ui.css">
        <link rel="stylesheet" href="../assets/css/mkdocs.css">
            <link href="../css/style.css" rel="stylesheet">

        
            <link  rel="icon" type="image/x-icon" href="../assets/img/favicon.ico">
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
                <script>hljs.initHighlightingOnLoad();</script>

</head>

<body class="drac-bg-black-secondary drac-text-grey-ternary drac-text drac-scrollbar-purple">

    <main class="d-flex">

        <!-- block sidebar -->
            <nav id="sidebar" class="sidebar drac-bg-black">
    <div class="custom-menu">
        <button type="button" id="sidebarCollapse" class="btn btn-primary">
            <i class="fa fa-bars"></i>
            <span class="sr-only">Menu</span>
        </button>
    </div>

    <div class="p-4">
        

        <div class="drac-text-center">
            
                <span class="drac-text drac-line-height drac-text-white">Meus Textos</span>
            
        </div>

        <div class="drac-box flex-column">
            <ul class="dot-ul">
                <li><div class="dot-li drac-bg-cyan"></div></li>
                <li><div class="dot-li drac-bg-green"></div></li>
                <li><div class="dot-li drac-bg-orange"></div></li>
                <li><div class="dot-li drac-bg-pink"></div></li>
                <li><div class="dot-li drac-bg-purple"></div></li>
                <li><div class="dot-li drac-bg-red"></div></li>
                <li><div class="dot-li drac-bg-yellow"></div></li>
            </ul>
        </div>

        <hr class="drac-divider" />

        <!-- block menu -->
        <ul class="mb-5 drac-list drac-list-none">
            
            <li class="drac-box">
                <a href=".."
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    C√≥digos de Artigos
                </a>
            </li>
            <li class="drac-box">
                <a href="../-%20Iniciar%20projeto%20poetry/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                      Iniciar projeto poetry
                </a>
            </li>
            <li class="drac-box">
                <a href="../Construindo%20uma%20API%20organizadinha%20em%20Golang%20usando%20Fiber/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Construindo uma API organizadinha em Golang usando Fiber
                </a>
            </li>
            <li class="drac-box">
                <a href="./"
                    class=" active 
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Criando uma API de p√°ginas est√°ticas b√°sica com Deno ü¶ï
                </a>
            </li>
            <li class="drac-box">
                <a href="../Docker%20Compose%20-%20MariaDB/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Docker Compose - MariaDB
                </a>
            </li>
            <li class="drac-box">
                <a href="../Documenta%C3%A7%C3%A3o%20Autom%C3%A1tica%20usando%20MkDocs%20e%20Python/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Documenta√ß√£o Autom√°tica usando MkDocs e Python
                </a>
            </li>
            <li class="drac-box">
                <a href="../Usando%20DDD%20com%20FastAPI%20e%20subaplica%C3%A7%C3%B5es/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Usando DDD com FastAPI e subaplica√ß√µes
                </a>
            </li>
        </ul>
        <!-- endblock -->
    </div>
</nav>
        <!-- endblock -->

        <nav class="divider drac-bg-purple-cyan"></nav>

        <div class="content">
            <!-- block header -->
                <header>
    <nav class="navbar navbar-expand-xl drac-bg-purple"">
        <div class="container-fluid">

            <!-- <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsMenu"
                aria-controls="navbarsMenu" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button> -->

            <div class="collapse navbar-collapse flex-column ml-auto" id="navbarsMenu">
                <ul class="navbar-nav">

                    <!-- block preview -->
                    <li class="nav-item">
                            
        <div class="container">
            <div class="row row-preview">
                <div class="col">
                    <a href="../Construindo%20uma%20API%20organizadinha%20em%20Golang%20usando%20Fiber/"
                        class="btn-preview drac-btn drac-btn-outline drac-text-white drac-text-cyan-green--hover">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </div>
                <div class="col">
                    <a href="../Docker%20Compose%20-%20MariaDB/"
                        class="btn-preview drac-btn drac-btn-outline drac-text-white drac-text-cyan-green--hover" style="padding-left: 3%;">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
                    </li>
                    <!--  endblock -->

                    <!-- block search -->
                    <li class="nav-item"><div role="search" class="search-box">
	<form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
		<input type="text" name="q" class="drac-input drac-input-search drac-input-white drac-text-white drac-bg-black-secondary"
		placeholder="Search docs" title="Type search term here" />
	</form>
</div>
                    </li>
                    <!--  endblock -->

                    <!-- block source -->
                    <li class="nav-item">
                        
                    </li>
                    <!--  endblock -->

                </ul>
            </div>

        </div>
    </nav>
</header>
            <!-- endblock -->

            <!-- block content -->
                <section class="p-md-5 section-content">
    <article>
        <p><h1 id="criando-uma-api-de-paginas-estaticas-basica-com-deno">Criando uma API de p√°ginas est√°ticas b√°sica com Deno ü¶ï</h1>
<p>Bom dia! meus caros compatriotas mineradores das profundezas do StackOverflow, esses √∫ltimos dias me veio uma vontade de como bom goiano dar uma sofrida e ao inv√©s de botar Maril√≠a Mendon√ßa preferi mexer com o famoso (ainda √©?) Deno que para minha grata supresa n√£o foi sofrimento nenhum! <img alt="üòÜ" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f606.svg" title=":laughing:" /></p>
<p>Porque minha surpresa? Primeiro o ecossistema √© bem simplista e receptivo para novos usu√°rios a toolkit que vem instalada trazem ferramentas como <code>deno fmt</code> que formata o c√≥digo de forma autom√°tica e um <code>deno lint</code> que achei sensacional fora que consegui configurar o debug no vscode tranquilamente, outro ponto que gostei bastante foi a standard library ser bem completa e vir com uma tipagem bem rica (sim sou um type junky).</p>
<p>Claro que h√° outros pontos que s√£o os principais diferencias para o seu irm√£o mais velho Node, mas n√£o vamos focar nas rusgas de fam√≠lia se quiser dar uma olhada a p√°gina inicial <a href="https://deno.land/">deno.land</a> cita alguns outros pontos legais.</p>
<h2 id="ideia-inicial">Ideia inicial</h2>
<p>Bem como objeto de estudo fiz uma API bem simples para testar algumas coisas como a integra√ß√£o do TypeScript com arquivos JSX que √© algo que eu li na documenta√ß√£o do Deno e curti bastante, ent√£o tive a ideia de fazer algo s√≥ para servir p√°ginas est√°ticas e ponto<img alt="üëç" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f44d.svg" title=":thumbsup:" />, √∫nico diferencial aqui √© que usei o m√°ximo poss√≠vel da standard library.</p>
<p><em><strong>Disclaimer:</strong></em> Olha a ideia n√£o √© ser perfeito inclusive se tiverem erros por favor me avise <img alt="ü§£" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f923.svg" title=":rolling_on_the_floor_laughing:" /> mas tentei deixar o escopo bem fechado porque se n√£o nunca iria terminar o que tinha proposto para mim mesmo e fiquei feliz com o resultado, tinha como fazer mais algumas coisas legais mas √© aquilo quem n√£o faz deploy de bug em produ√ß√£o n√£o se diverte!. (Sim √© s√≥ uma piada, caso esteja se perguntando)</p>
<h3 id="e-a-aventura-se-inicia">E a aventura se inicia</h3>
<p>De in√≠cio foi bem simples de instalar inclusive foi s√≥ um comando que baixava j√° um script de instala√ß√£o e j√° o executava e pronto j√° estava com o deno instalado fiz alguns testes e depois configurei para usar o <a href="https://asdf-vm.com/">asdf</a> o que n√£o √© necess√°rio mas eu gosto da ferramenta pela possibilidade de versionar a runtime e pronto com tudo configurado comecei a programar.</p>
<p>E come√ßar a botar a m√£o na massa foi algo bem simples, por assim dizer, n√£o √© necess√°rio dar um init para rodar basta dar um <code>deno run</code> e se tiver algo que ele precise instalar ele baixa na hora da execu√ß√£o e adiciona as informa√ß√µes da vers√£o em um <em>package-lock.json</em> algo bem semelhante ao que acontece no Node.js, mas de forma mais minimalista, por assim dizer j√° que n√£o √© necess√°rio ter um <em>package.json</em> para interagirmos e configurarmos, algo que achei ruim disso √© que para o meu caso tive que criar um <em>makefile</em> para agilizar um pouco a execu√ß√£o vamos falar disso mais √† frente.</p>
<p>Olha aqui eu vou aos pouquinhos e vou explicar alguns detalhes de TypeScript para quem n√£o est√° muito familiarizado n√£o se perder.</p>
<p><img alt="Imagem com o import e uma interface sendo declarada" src="https://github.com/XandeCoding/codigos-de-artigos/blob/main/deno/site_server_side/doc_images/import-type-http.png?raw=true" /></p>
<p>Bem aqui j√° come√ßam as diferen√ßas Deno usa um esquema de import de libs externas via url, isso traz uma coisa √≥tima que √© a possibilidade de usar arquivos independentes da onde estejam da internet se √© poss√≠vel fazer o download ele funciona.</p>
<p>Neste caso estou importando e j√° retirando somente a fun√ß√£o de serve que vamos usar para iniciar o servidor.</p>
<p>Abaixo temos um tipo que explicita qual vai ser o "formato" de um objeto de rota, se pararmos para pensar o m√≠nimo que precisamos para criar uma rota (endpoint para os mais √≠ntimos) √© ter uma a√ß√£o e ter o "caminho" para essa a√ß√£o ser executada, por exemplo o caminho pode ser um '/index' e a a√ß√£o √© entregar um simples HTML.</p>
<p>Criei isso para facilitar para quem for criar uma rota no futuro n√£o ter que adivinhar ou ter que dar uma de detetive para descobrir os dados necess√°rios para uma rota funcional ser criada.</p>
<p>Basicamente esse <em><strong>k</strong></em> se refere a chave do objeto e que deve ser string, e essa mesma chave vai receber como valor uma Promise que retorna uma inst√¢ncia de response. Tabom ficou meio confuso mas basicamente eu vou ter um objeto JSON que s√≥ recebe chaves em texto como letras e frases e elas v√£o ter como valor uma fun√ß√£o ass√≠ncrona que retorna a resposta para o cliente, isso vai ficar mais claro mais a frente.</p>
<p>Agora vamos fazer o core da nossa aplica√ß√£o que √© o que vai receber as chamadas e encaminhar para as rotas certas.</p>
<p><img alt="Classe http server" src="https://github.com/XandeCoding/codigos-de-artigos/blob/main/deno/site_server_side/doc_images/http-server.png?raw=true" /></p>
<p>Bem vou me aprofundar mais na fun√ß√£o <em>initServerHandler</em> nela eu filtro os m√©todos como vou somente servir p√°ginas est√°ticas quero receber somente chamadas do tipo 'GET', depois eu crio uma url isso √© legal para poder pegar o pathname que o caminho, por exemplo, se eu colocar no meu navegador o endere√ßo <em>https://localhost:7000/teste</em> o pathname √© <em>/teste</em> isso √© uma abordagem bem simplista, mas para nosso caso serve muito bem.</p>
<p>Lembra da nossa declara√ß√£o <em>IRoute</em> aqui que come√ßa a brincadeira vamos acessar de forma direta a rota e j√° vamos executar a fun√ß√£o que est√° salva nela, por exemplo, em um objeto como o abaixo:</p>
<pre><code class="language-js">
{

'/': async () =&gt;  new  Response('Hello World')

}

</code></pre>
<p>Ao entrar na chave '/' ele me traz a fun√ß√£o que mostra um <em>Hello World</em> bem bonito para o usu√°rio.</p>
<p>Agora mais abaixo temos a fun√ß√£o <strong>serve</strong> nela que a brincadeira j√° come√ßa a rolar, ela inicia a fun√ß√£o <em>initServerHandler</em> e faz um <em>bind</em>? O que seria esse tal de bind?</p>
<p>Bem para entendermos isso precisamos pensar em como essa fun√ß√£o vai ser executada, pois, essa fun√ß√£o ela vai ser entregue para o server, mas n√£o ir√° ser executada ali, mas quando ele receber uma requisi√ß√£o e isso ocorre dentro de outro escopo e n√£o na fun√ß√£o <strong><em>serve</em></strong>, e nessa altura como a fun√ß√£o vai achar a inst√¢ncia de HTTPServer com as rotas se ele √© somente uma fun√ß√£o que foi passada para outro escopo? Para isso usamos o bind ele insere a propriedade <strong>routes</strong> que foi colocada na classe no momento da cria√ß√£o da instancia√ß√£o do <em><strong>HTTPServer</strong></em> que criamos e a deixa acess√≠vel dentro dela quase como se ela fosse um "par√¢metro", mas √© acessada como uma propriedade da fun√ß√£o, por isso quando damos um <em>this.routes</em> conseguimos acessar as rotas, ele acessa a propriedade routes da fun√ß√£o e n√£o da classe <strong>HTTPServer</strong>.</p>
<h3 id="e-a-aventura-estava-ficando-sem-fim">E a aventura estava ficando sem fim</h3>
<p>Essa brincadeira estava at√© bem divertida, mas eu j√° tinha tido ido o suficiente adentro da toca do coelho e estava satisfeito (Mundo de Alice vibes <img alt="üçÉ" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f343.svg" title=":leaves:" />). Ent√£o fiz uma fun√ß√£o para renderizar HTML puro e arquivos JSX, bem arquivos HTML n√£o tem muito segredo ent√£o vamos dar uma olhada em como fazer isso usando JSX.</p>
<p>Algo que n√£o sabia era que Typescript estava dando suporte nativo para JSX isso significa que podemos com algumas configura√ß√µes importar estes arquivos e us√°-los para renderizar p√°ginas para nossos clientes.</p>
<p>Para isso precisamos fazer uma pequena configura√ß√£o no nosso arquivo <code>tsconfig.json</code> o meu ficou dessa forma.</p>
<p><img alt="Arquivo tsconfig.json" src="https://github.com/XandeCoding/codigos-de-artigos/blob/main/deno/site_server_side/doc_images/ts-config.png?raw=true" /></p>
<ul>
<li>
<p>O <a href="https://www.typescriptlang.org/tsconfig#jsx"><code>jsx</code></a> se refere a como o arquivo JSX vai ser constru√≠do ao ser importado, essa config <code>react-jsx</code> permite que usemos outra runtime, nesse caso estamos usando o Preact como vamos ver abaixo</p>
</li>
<li>
<p><a href="https://www.typescriptlang.org/tsconfig#jsxImportSource"><code>jsxImportSource</code></a> Essa propriedade em conjunto com a op√ß√£o acima define qual vai ser o m√≥dulo que vai ser usado para importar o JSX e construir o componente ao ser exportado.</p>
</li>
</ul>
<p>Agora temos a fun√ß√£o que importa o arquivo JSX de forma gen√©rica (n√£o queremos ter que criar uma fun√ß√£o para cada JSX que criemos n√£o √©?)</p>
<p><img alt="Fun√ß√£o que faz a renderiza√ß√£o do componente JSX" src="https://github.com/XandeCoding/codigos-de-artigos/blob/main/deno/site_server_side/doc_images/renderJSXTemplate.png?raw=true" /></p>
<p>N√£o vou me apegar muito os detalhes de import ou da tipagem dos tipos, pois isso n√£o √© a m√°gica (e j√° conversamos sobre esse <em>Record</em> mais acima tamb√©m). O que ela faz √© basicamente importar o arquivo e usar uma fun√ß√£o de render do Preact e aqui est√° a m√°gica.</p>
<ul>
<li>
<p>Primeiro importamos a lib <code>preact-render-to-string</code> do cdn skypack ele tem bastante libs j√° configuradas para rodar no Deno, muita coisa que roda no Node funciona no Deno, mas algumas precisam de altera√ß√£o principalmente as que fazem opera√ß√µes no disco, ent√£o j√° ter algo configurado facilita bastante.</p>
</li>
<li>
<p>Mas na fun√ß√£o n√≥s importamos o componente de forma ass√≠ncrona (legal n√©? JavaScript √†s vezes nos proporciona essas boas surpresas :the_horns:), quando esse arquivo √© importado a fun√ß√£o j√° passa por uma transforma√ß√£o usando o <em>Preact</em> que configuramos mais cedo e se torna um arquivo utiliz√°vel dentro do nosso c√≥digo, n√£o se esque√ßa que TypeScript transforma tudo em JavaScript antes de ser executado o JSX s√≥ passa por um processo um pouco diferente.</p>
</li>
</ul>
<p><img alt="Componente JSX" src="https://github.com/XandeCoding/codigos-de-artigos/blob/main/deno/site_server_side/doc_images/jsx.png?raw=true" /></p>
<ul>
<li>Este arquivo acima √© um componente que criei bem simples somente para demonstrar, veja que estou exportando ele como default isso ajuda na hora de importar na fun√ß√£o acima, pois j√° sei bem onde acessar o componente no m√≥dulo.</li>
</ul>
<p><img alt="JSX Template Handler" src="https://github.com/XandeCoding/codigos-de-artigos/blob/main/deno/site_server_side/doc_images/JSXTemplateHandler.png?raw=true" /></p>
<ul>
<li>
<p>Com essa fun√ß√£o de renderiza√ß√£o podemos j√° us√°-la no nosso handler e nele o arquivo √© renderizado e adicionado um headers e uma response v√°lida √© retornada (sim algumas coisas s√£o bem chatas quando n√£o se usa um framework <img alt="üò¢" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f622.svg" title=":cry:" />)</p>
</li>
<li>
<p>E para utilizarmos este handler basta configurarmos a nossa rota, lembra do nosso HTTPServer vamos brincar com ele agora, mas n√£o tem muita emo√ß√£o (felizmente).</p>
</li>
</ul>
<p><img alt="Inicializa√ß√£o das rotas" src="https://github.com/XandeCoding/codigos-de-artigos/blob/main/deno/site_server_side/doc_images/main.png?raw=true" /></p>
<p>Se voc√™ tem uma mem√≥ria boa (ou somente rolou a p√°gina para cima ü§∑) vai lembrar da interface que o nosso <code>HTTPServer</code> recebe, basta mandar a rota e o <em>handler</em> que √© a fun√ß√£o que executa a a√ß√£o ao acessamos aquele endpoint e depois usarmos a fun√ß√£o <em>serve</em>.</p>
<h4 id="executando">Executando</h4>
<p>Para executar h√° um diferencial, Deno pede (insiste melhor dizendo) que voc√™ especifique as permiss√µes que a aplica√ß√£o dever√° ter no nosso caso, √© necess√°rio a de <em>net</em>, pois √© uma API web acho que est√° explicito o porque (ela precisa acessar a rede) e de <em>read</em> pois vamos ler alguns arquivos.</p>
<p>Um ponto interessante √© que se fossemos usar somente o import comum n√£o precisar√≠amos, pois o mesmo j√° estaria incluso na hora que rod√°ssemos a aplica√ß√£o, mas como os arquivos que cont√©m os componentes JSX s√£o importados de forma ass√≠ncrona sendo lidos em tempo de execu√ß√£o, ele precisa que demos permiss√£o, pois n√£o √© adicionado na hora que compilamos mas depois ou nunca depende se vamos acessar a rota que usa o componente.</p>
<p>Segue abaixo o c√≥digo para executar o brinquedo.</p>
<p><code>deno run --config tsconfig.json --allow-net --allow-read ./src/main.ts</code></p>
<h4 id="depois-de-20-mil-leguas-submarinas">Depois de 20 mil l√©guas submarinas</h4>
<p>Chegamos ao final espero que n√£o tenha sido uma viagem para o mundo da Chatol√¢ndia a leitura desse texto, mas sim uma olhada pelo retrovisor ap√≥s o hype do Deno passar de seu ecossistema e de algumas diferen√ßas do seu irm√£o mais velho Node.js. üëãüëãüëã</p></p>
    </article>
</section>
            <!-- endblock -->

            <!-- block footer -->
                <footer>
    <div class="d-flex flex-sm-row justify-content-between py-2 border-top drac-text-black drac-bg-cyan-green">
        <a href="https://github.com/dracula/mkdocs" target="_blank" style="padding-left: 1%;"
            class="footer-text drac-anchor drac-text-black drac-text-purple--hover">
            Made with Dracula Theme for MkDocs
        </a>
    </div>
</footer>
            <!-- endblock -->
        </div>

    </main>

        <script>var base_url = '..';</script>
        <script src="../assets/js/jquery-3.3.1.slim.min.js""></script>
        <script src="../assets/js/bootstrap.bundle.min.js""></script>
        <script src="../assets/js/mkdocs.js""></script>
			<script src="../search/main.js" defer></script>

</body>

</html>
